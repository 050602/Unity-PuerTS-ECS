(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s="./Script/view/TSMain.ts")})({"./Script/core/BaseView.ts":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.BaseView=void 0;const csharp_1=__webpack_require__("csharp");const UIManager_1=__webpack_require__("./Script/core/UIManager.ts");class BaseView extends csharp_1.FairyGUI.GComponent{onInit(){}onOpen(args=null){csharp_1.Log.log("onOpen:"+this.uiId)}onClose(){}onDestroy(){if(this.bindKeys!=null){this.bindKeys=null}}close(){UIManager_1.UIManager.getInstance().closeView(this.uiId)}}exports.BaseView=BaseView},"./Script/core/GameConst.ts":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AttrVar=exports.Attr=exports.GameUpdateCD=void 0;var frameRate=60;exports.GameUpdateCD=.03;var Attr;(function(Attr){Attr[Attr["MoveSpeed"]=1]="MoveSpeed";Attr[Attr["AttackSpeed"]=2]="AttackSpeed";Attr[Attr["Attack"]=3]="Attack";Attr[Attr["AttackRange"]=4]="AttackRange";Attr[Attr["Hp"]=5]="Hp";Attr[Attr["MaxHp"]=6]="MaxHp";Attr[Attr["FlySpeed"]=7]="FlySpeed";Attr[Attr["FlySpeedPercent"]=8]="FlySpeedPercent"})(Attr=exports.Attr||(exports.Attr={}));var AttrVar;(function(AttrVar){AttrVar[AttrVar["ProjectilesMultipleCasting"]=10001]="ProjectilesMultipleCasting";AttrVar[AttrVar["ProjectilesAddNumber"]=10002]="ProjectilesAddNumber"})(AttrVar=exports.AttrVar||(exports.AttrVar={}))},"./Script/core/ObjectPool.ts":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ObjectPool=void 0;class ObjectPool{static getObjectByClass(className,T){let arr=ObjectPool.pool.get(className);if(!arr||!arr.length){let t=new T;this.useCount++;return t}let t=arr.shift();this.reUsrCount++;return t}static getObject(className){let arr=ObjectPool.pool.get(className);if(!arr||!arr.length){return null}let t=arr.shift();this.reUsrCount++;return t}static getPoolLength(className){let arr=ObjectPool.pool.get(className);return arr.length}static recover(className,obj){let arr=ObjectPool.pool.get(className);if(!arr){arr=[]}if(obj.recycleToObjectPool){obj.recycleToObjectPool()}arr.push(obj);this.reCount++;this.pool.set(className,arr)}static clearPool(className){ObjectPool.pool.delete(className)}static checkAllObject(){}}exports.ObjectPool=ObjectPool;ObjectPool.pool=new Map;ObjectPool.useCount=0;ObjectPool.reCount=0;ObjectPool.reUsrCount=0},"./Script/core/Sigleton.ts":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Sigleton=void 0;class Sigleton{constructor(){}initInstance(){}destoryInstance(){}static getInstance(T){if(T.instance==null){T.instance=new T;T.instance.initInstance()}return T.instance}}exports.Sigleton=Sigleton},"./Script/core/TimerTS.ts":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TimerTS=void 0;const Sigleton_1=__webpack_require__("./Script/core/Sigleton.ts");const csharp_1=__webpack_require__("csharp");const GameConst_1=__webpack_require__("./Script/core/GameConst.ts");class TimerTS extends Sigleton_1.Sigleton{constructor(){super(...arguments);this.uid=1}static getInstance(){return super.getInstance(TimerTS)}initInstance(){csharp_1.EventCenter.Instance.bind(csharp_1.TSEvent.TICK,this,this.update)}getUID(){return this.uid++}update(systobj,args){if(TimerTS._pause)return;let arr=TimerTS._arr;for(let i=0;i<arr.length;i++){let dt=GameConst_1.GameUpdateCD;let obj=arr[i];obj.accTime+=dt;if(obj.delay){let delay=obj.delay;if(obj.accTime>=delay){obj.accTime=0;obj.delay=0}}else{let func=obj.callback;let thisObj=obj.thisObj;let interval=obj.interval;if(obj.accTime>=interval){obj.accTime-=interval;if(interval!=0){dt=interval}if(obj.repeat>0){obj.repeat--;func.apply(thisObj,[dt]);if(obj.repeat==0){arr.splice(i,1);i--}}else{func.apply(thisObj,[dt])}}}}}loop(thisObj,callback,interval=0,repeat=0,runNow=false,delay){for(let i=0;i<TimerTS._arr.length;i++){if(TimerTS._arr[i].thisObj==thisObj&&TimerTS._arr[i].callback==callback){csharp_1.Log.logWarning("重复注册定时器");return}}if(!TimerTS._isRunning){TimerTS._isRunning=true;csharp_1.TSMain.Instance.startRunTime()}let obj={callback:callback,thisObj:thisObj,interval:interval,repeat:repeat,accTime:0,delay:delay,uid:this.getUID()};if(runNow){callback.apply(thisObj,[0])}TimerTS._arr.push(obj);return obj}clear(thisObj,callback){let arr=TimerTS._arr;for(let n=0;n<arr.length;n++){let obj=arr[n];if(obj.callback==callback&&obj.thisObj==thisObj){arr.splice(n,1);return}}TimerTS.checkStop()}once(thisObj,callback,delay){return this.loop(thisObj,callback,delay,1)}get pause(){return TimerTS._pause}set pause(_pause){TimerTS._pause=_pause}static checkStop(){if(!TimerTS._arr.length){csharp_1.TSMain.Instance.stopRunTime();TimerTS._isRunning=false}}}exports.TimerTS=TimerTS;TimerTS._isRunning=false;TimerTS._arr=[];TimerTS._pause=false},"./Script/core/UIManager.ts":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.UIManager=exports.UILayer=void 0;const Sigleton_1=__webpack_require__("./Script/core/Sigleton.ts");const csharp_1=__webpack_require__("csharp");const puerts_1=__webpack_require__("puerts");const ViewConst_1=__webpack_require__("./Script/core/ViewConst.ts");const ViewEvent_1=__webpack_require__("./Script/event/ViewEvent.ts");const TSEventCenter_1=__webpack_require__("./Script/event/TSEventCenter.ts");const LogTS_1=__webpack_require__("./Script/utils/LogTS.ts");const TimerTS_1=__webpack_require__("./Script/core/TimerTS.ts");var UILayer;(function(UILayer){UILayer[UILayer["Background"]=0]="Background";UILayer[UILayer["Main"]=1]="Main";UILayer[UILayer["Module"]=2]="Module";UILayer[UILayer["Pop"]=3]="Pop";UILayer[UILayer["Fight"]=4]="Fight";UILayer[UILayer["FightUI"]=5]="FightUI";UILayer[UILayer["Tips"]=6]="Tips";UILayer[UILayer["Top"]=7]="Top";UILayer[UILayer["Loading"]=8]="Loading";UILayer[UILayer["Cmd"]=9]="Cmd";UILayer[UILayer["Toast"]=10]="Toast"})(UILayer=exports.UILayer||(exports.UILayer={}));class UIInfo{constructor(uiId,layer,cache,args1=null,isTsView=false,isOpening=true,isClose=false){this.uiId=uiId;this.layer=layer;this.cache=cache;this.isClose=isClose;this.isOpening=isOpening;this.isTsView=isTsView;this.args1=args1}}class UIManager extends Sigleton_1.Sigleton{constructor(){super(...arguments);this.dic=new Map;this.viewCacheDic=new Map;this.layerDic=new Map;this.packageCache=[];this.stackList=[];this.loadingList=[]}static getInstance(){return super.getInstance(UIManager)}initInstance(){for(let key in UILayer){let keyToAny=key;if(isNaN(keyToAny)){let typeNum=UILayer[key];let layerName=typeNum;let gc=new csharp_1.FairyGUI.GComponent;gc.name=layerName.toString();gc.gameObjectName=layerName.toString();gc.width=csharp_1.FairyGUI.GRoot.inst.width;gc.height=csharp_1.FairyGUI.GRoot.inst.height;gc.AddRelation(csharp_1.FairyGUI.GRoot.inst,csharp_1.FairyGUI.RelationType.Width);gc.AddRelation(csharp_1.FairyGUI.GRoot.inst,csharp_1.FairyGUI.RelationType.Height);gc.MakeFullScreen();csharp_1.FairyGUI.GRoot.inst.AddChild(gc);this.layerDic.set(layerName,gc)}}this.layerDic.get(UILayer.Fight).fairyBatching=true;this.layerDic.get(UILayer.FightUI).fairyBatching=true;this.initLoading()}async initLoading(){await this.addPackage("Loading");this.loading=csharp_1.FairyGUI.UIPackage.CreateObject("Loading","LoadingView").asCom;this.layerDic.get(UILayer.Loading).AddChild(this.loading);this.loading.x=(csharp_1.FairyGUI.GRoot.inst.width-this.loading.width)*.5;this.loading.y=(csharp_1.FairyGUI.GRoot.inst.height-this.loading.height)*.5;this.loading.visible=false}getLayerByUILayer(layer){var gcom=this.layerDic.get(layer);return gcom}showLoading(dt){if(this.loadingList.length>0){this.loading.visible=true}else{this.loading.visible=false;TimerTS_1.TimerTS.getInstance().clear(this,this.showLoading)}}setLoading(uiId){if(!this.loading){return}let index=this.loadingList.indexOf(uiId);if(index!=-1){csharp_1.Log.logWarning("指定界面已经进入Loading:"+uiId);return}this.loadingList.push(uiId);TimerTS_1.TimerTS.getInstance().once(this,this.showLoading,.35)}clearLoading(uiId){let index=this.loadingList.indexOf(uiId);this.loadingList.splice(index,1);if(this.loadingList.length==0){this.loading.visible=false;TimerTS_1.TimerTS.getInstance().clear(this,this.showLoading)}}async addPackage(name){if(this.packageCache.indexOf(name)!=-1){return true}var path="Assets/Assets/UI/"+name+"_fui.bytes";if(csharp_1.AddressablesMgr.Instance.getFGUIAsset(path)==null){let task=csharp_1.AddressablesMgr.Instance.loadFGUITextAsset(path);await puerts_1.$promise(task);var len=ViewConst_1.ViewConst.pngStrDic.get(name);if(len){let task2=csharp_1.AddressablesMgr.Instance.loadFGUITexture("Assets/Assets/UI/"+name+"_atlas0.png");await puerts_1.$promise(task2);for(var i=1;i<len;i++){let task3=csharp_1.AddressablesMgr.Instance.loadFGUITexture("Assets/Assets/UI/"+name+"_atlas0_"+i+".png");await puerts_1.$promise(task3)}}}csharp_1.FairyGUI.UIPackage.AddPackage(name,csharp_1.AddressablesMgr.LanLuLoadFunc);this.packageCache.push(name);return true}clearPackage(name){csharp_1.FairyGUI.UIPackage.RemovePackage(name);let path="Assets/Assets/UI/"+name+"_fui.bytes";let obj=csharp_1.AddressablesMgr.Instance.getFGUIAsset(path);if(obj!=null){csharp_1.AddressablesMgr.Instance.releaseTextAsset(obj);var len=ViewConst_1.ViewConst.pngStrDic.get(name);if(len){let tx1=csharp_1.AddressablesMgr.Instance.getFGUIAsset("Assets/Assets/UI/"+name+"_atlas0.png");csharp_1.AddressablesMgr.Instance.releaseTexture(tx1);for(var i=1;i<len;i++){let tx2=csharp_1.AddressablesMgr.Instance.getFGUIAsset("Assets/Assets/UI/"+name+"_atlas0_"+i+".png");csharp_1.AddressablesMgr.Instance.releaseTexture(tx2)}}}let index=this.packageCache.indexOf(name);this.packageCache.splice(index,1)}closeView(uiId,throwWarn=true){let lastinfo=this.dic.get(uiId);if(lastinfo){if(!lastinfo.isTsView){LogTS_1.gzaLog("尝试关闭非TS的VIew",uiId);return}let view=this.viewCacheDic.get(uiId);if(view){if(lastinfo.cache){view.visible=false;lastinfo.isClose=true;view.onClose();let index=this.stackList.indexOf(uiId);if(index>-1){this.stackList.splice(index,1)}return}else{view.onClose();view.onDestroy();view.Dispose();let index=this.stackList.indexOf(uiId);if(index>-1){this.stackList.splice(index,1)}this.dic.delete(uiId);this.viewCacheDic.delete(uiId)}csharp_1.EventCenter.Instance.eventFunc(ViewEvent_1.ViewEvent.VIEW_CLOSE,uiId);TSEventCenter_1.TSEventCenter.getInstance().event(ViewEvent_1.ViewEvent.VIEW_OPEN,uiId)}else{csharp_1.Log.logWarning("尝试关闭不存在的界面:"+uiId)}}else{if(throwWarn){csharp_1.Log.logWarning("尝试关闭不存在的界面:"+uiId)}}}async preLoadView(uiId,layer){let pkgname=ViewConst_1.ViewConst.pkgNameDic.get(uiId);if(pkgname){let task=await this.addPackage(pkgname);let comName=ViewConst_1.ViewConst.comNameDic.get(uiId);if(comName){let info=new UIInfo(uiId,layer,true,null,true);this.dic.set(uiId,info);LogTS_1.gzaLog("preLoadView",uiId,info.isTsView);csharp_1.FairyGUI.UIPackage.CreateObjectAsync(pkgname,comName,this.preloadViewOver)}else{csharp_1.Log.logWarning("尝试打开不存在的界面 找不到组件 界面ID:"+uiId)}}else{csharp_1.Log.logWarning("尝试打开不存在的界面 找不到组件 界面ID:"+uiId)}}async openView(uiId,layer,isCache=false,args1=null){let lastinfo=this.dic.get(uiId);if(lastinfo){if(!lastinfo.isTsView){LogTS_1.gzaLog("尝试打开非TS的VIew",uiId);return}if(lastinfo.isOpening){LogTS_1.gzaLog("界面:"+uiId+"正在打开中，触发重复打开");return}if(lastinfo.cache){let view=this.viewCacheDic.get(uiId);if(view){view.visible=true;lastinfo.isClose=false;let layerCom=this.layerDic.get(lastinfo.layer);if(layerCom){layerCom.AddChild(view);this.stackList.push(uiId);lastinfo.args1=args1;if(ViewConst_1.ViewConst.scaleDic.has(uiId)){if(csharp_1.FairyGUI.GRoot.inst.width<csharp_1.FairyGUI.GRoot.inst.height){view.scaleX=1;view.scaleY=1;view.SetSize(csharp_1.FairyGUI.GRoot.inst.width,csharp_1.FairyGUI.GRoot.inst.height)}else{let percent=csharp_1.FairyGUI.GRoot.inst.height/csharp_1.FairyGUI.GRoot.inst.width;view.scaleX=percent;view.scaleY=percent;view.SetSize(csharp_1.FairyGUI.GRoot.inst.width/percent,csharp_1.FairyGUI.GRoot.inst.height/percent)}}view.onOpen(args1);csharp_1.EventCenter.Instance.eventFunc(ViewEvent_1.ViewEvent.VIEW_OPEN,uiId);return}}}}else{let pkgname=ViewConst_1.ViewConst.pkgNameDic.get(uiId);if(pkgname){this.setLoading(uiId);let task=await this.addPackage(pkgname);let comName=ViewConst_1.ViewConst.comNameDic.get(uiId);if(comName){if(!this.dic.has(uiId)){let info=new UIInfo(uiId,layer,isCache,args1,true);this.dic.set(uiId,info)}csharp_1.FairyGUI.UIPackage.CreateObjectAsync(pkgname,comName,this.loadViewOver)}else{csharp_1.Log.logWarning("尝试打开不存在的界面 找不到组件 界面ID:"+uiId);this.clearLoading(uiId)}}else{csharp_1.Log.logWarning("尝试打开不存在的界面 找不到包 界面ID:"+uiId)}}}loadViewOver(obj){let com=obj.asCom;let url=obj.resourceURL;let thisobj=UIManager.getInstance();let uiId=ViewConst_1.ViewConst.resURLDic.get(url);if(uiId){let info=thisobj.dic.get(uiId);if(info){if(!info.isTsView){LogTS_1.gzaLog("加载完毕非TS的VIew",uiId);return}if(!info.isOpening){if(!info.cache){obj.Dispose()}return}info.isOpening=false;info.isClose=false;let layer=thisobj.layerDic.get(info.layer);if(layer){layer.AddChild(com);let baseview=com;if(baseview==null){csharp_1.Log.logError("没有绑定扩展类，XXXBinder!");return}baseview.uiId=uiId;baseview.MakeFullScreen();thisobj.viewCacheDic.set(uiId,baseview);if(ViewConst_1.ViewConst.scaleDic.has(uiId)){if(csharp_1.FairyGUI.GRoot.inst.width<csharp_1.FairyGUI.GRoot.inst.height){baseview.scaleX=1;baseview.scaleY=1;baseview.SetSize(csharp_1.FairyGUI.GRoot.inst.width,csharp_1.FairyGUI.GRoot.inst.height)}else{let percent=csharp_1.FairyGUI.GRoot.inst.height/csharp_1.FairyGUI.GRoot.inst.width;baseview.scaleX=percent;baseview.scaleY=percent;baseview.SetSize(csharp_1.FairyGUI.GRoot.inst.width/percent,csharp_1.FairyGUI.GRoot.inst.height/percent)}}baseview.onInit();baseview.onOpen(info.args1);thisobj.stackList.push(uiId);csharp_1.EventCenter.Instance.eventFunc(ViewEvent_1.ViewEvent.VIEW_OPEN,uiId);TSEventCenter_1.TSEventCenter.getInstance().event(ViewEvent_1.ViewEvent.VIEW_OPEN,uiId);thisobj.clearLoading(uiId)}}}else{csharp_1.Log.logWarning(url+"指定资源URL未注册")}}preloadViewOver(obj){let com=obj.asCom;let url=obj.resourceURL;let thisobj=UIManager.getInstance();let uiId=ViewConst_1.ViewConst.resURLDic.get(url);if(uiId){let info=thisobj.dic.get(uiId);if(info){if(!info.isTsView){LogTS_1.gzaLog("预加载完毕非TS的VIew",uiId);return}info.isOpening=false;info.isClose=true;let cacheView=thisobj.viewCacheDic.get(uiId);if(cacheView){LogTS_1.gzaLog("预加载完毕时，界面已打开："+uiId);return}com.visible=false;let baseview=com;baseview.uiId=uiId;baseview.MakeFullScreen();baseview.onInit();LogTS_1.gzaLog("预加载完毕 ID：",uiId,baseview.uiId);thisobj.viewCacheDic.set(uiId,baseview);csharp_1.EventCenter.Instance.eventFunc(ViewEvent_1.ViewEvent.VIEW_PRELOAD_OVER,uiId);TSEventCenter_1.TSEventCenter.getInstance().event(ViewEvent_1.ViewEvent.VIEW_PRELOAD_OVER,uiId)}}else{csharp_1.Log.logWarning(url+"指定资源URL未注册")}}}exports.UIManager=UIManager},"./Script/core/ViewConst.ts":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ViewConst=void 0;const MainUIBinder_1=__webpack_require__("./Script/view/MainUIView/MainUIBinder.ts");const MainUIView_1=__webpack_require__("./Script/view/MainUIView/MainUIView.ts");class ViewConst{static init(){ViewConst.pngStrDic.set("Loading",1);ViewConst.initMainUI()}static initMainUI(){ViewConst.pkgNameDic.set(ViewConst.MainUIView_ID,"MainUI");ViewConst.pngStrDic.set("MainUI",1);ViewConst.pngStrDic.set("SkillJoy",1);ViewConst.comNameDic.set(ViewConst.MainUIView_ID,ViewConst.MainUIView_ID);ViewConst.resURLDic.set(MainUIView_1.MainUIView.URL,ViewConst.MainUIView_ID);MainUIBinder_1.default.BindAll()}}exports.ViewConst=ViewConst;ViewConst.MainUIView_ID="MainUIView";ViewConst.LevelUpDialogView_ID="LevelUpDialogView";ViewConst.MagicChangeDialog_ID="MagicChangeDialog";ViewConst.MagicEditDialog_ID="MagicEditDialog";ViewConst.WeaponLevelUpDialog_ID="WeaponLevelUpDialog";ViewConst.RewardView_ID="RewardView";ViewConst.pkgNameDic=new Map;ViewConst.comNameDic=new Map;ViewConst.resURLDic=new Map;ViewConst.pngStrDic=new Map;ViewConst.scaleDic=new Map},"./Script/core/ecs/base/ECSComponent.ts":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ECSComponent=void 0;class ECSComponent{recycleToObjectPool(){this.entityId=0}}exports.ECSComponent=ECSComponent;ECSComponent.ComName="ECSComponent"},"./Script/core/ecs/base/ECSEntity.ts":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ECSEntity=void 0;const csharp_1=__webpack_require__("csharp");const ObjectPool_1=__webpack_require__("./Script/core/ObjectPool.ts");const ECSManager_1=__webpack_require__("./Script/core/ecs/base/ECSManager.ts");class ECSEntity{constructor(){this.components=new Map;this.active=true}recycleToObjectPool(){this.id=0;for(let com of this.components.values()){ECSManager_1.ECSManager.getInstance().removeCom(com);ObjectPool_1.ObjectPool.recover(com.name,com)}this.components.clear()}getCom(type){return this.components.get(type.ComName)}getComByName(name){return this.components.get(name)}addCom(type){if(this.components.has(type.ComName)){csharp_1.Log.logError("该实体已拥有此组件:",type.ComName);return}let com=ObjectPool_1.ObjectPool.getObjectByClass(type.ComName,type);com.entityId=this.id;this.components.set(com.name,com);ECSManager_1.ECSManager.getInstance().addCom(com);return com}removeCom(type){let com=this.components.get(type.ComName);if(com){ECSManager_1.ECSManager.getInstance().removeCom(com);ObjectPool_1.ObjectPool.recover(type.ComName,com);this.components.delete(com.name)}}hasCom(comName){return this.components.has(comName)}}exports.ECSEntity=ECSEntity},"./Script/core/ecs/base/ECSManager.ts":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ECSManager=void 0;const ObjectPool_1=__webpack_require__("./Script/core/ObjectPool.ts");const Sigleton_1=__webpack_require__("./Script/core/Sigleton.ts");const TimerTS_1=__webpack_require__("./Script/core/TimerTS.ts");const ECSEntity_1=__webpack_require__("./Script/core/ecs/base/ECSEntity.ts");class ECSManager extends Sigleton_1.Sigleton{constructor(){super(...arguments);this.uid=1}static getInstance(){return super.getInstance(ECSManager)}register(){}initInstance(){this.entitys=new Map;this.systems=new Map;this.runningSystems=new Map;this.uid=1;TimerTS_1.TimerTS.getInstance().loop(this,this.update);this.register()}update(dt){this.runningSystems.forEach(value=>{value.update(dt)})}getEntity(uid){return this.entitys.get(uid)}getSystem(type){return this.systems.get(type.SystemName)}getUid(){return this.uid++}getSystemByName(name){return this.systems.get(name)}createEntity(){let ent=ObjectPool_1.ObjectPool.getObjectByClass("ECSEntity",ECSEntity_1.ECSEntity);ent.id=this.uid++;this.entitys.set(ent.id,ent);return ent}recoverEntity(ent){let id=ent.id;ObjectPool_1.ObjectPool.recover("ECSEntity",ent);this.entitys.delete(id)}addCom(com){let entity=this.entitys.get(com.entityId);if(entity){for(let value of this.systems.values()){let canActvie=true;for(let i=0;i<value.bindTypes.length;i++){if(!entity.hasCom(value.bindTypes[i])){canActvie=false;continue}}if(canActvie){if(!value.entitys.has(com.entityId)){value.entitys.set(com.entityId,true);value.onWatchEntity(com.entityId);if(!this.runningSystems.has(value.name)){this.runningSystems.set(value.name,value)}}}}}}removeCom(com){let entity=this.entitys.get(com.entityId);if(entity){for(let value of this.systems.values()){if(!value.entitys.has(com.entityId)){continue}if(value.bindTypes.indexOf(com.name)!=-1){value.entitys.delete(com.entityId);if(value.entitys.size<=0){this.runningSystems.delete(value.name)}}}}}}exports.ECSManager=ECSManager},"./Script/event/TSEventCenter.ts":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TSEventCenter=void 0;const csharp_1=__webpack_require__("csharp");const Sigleton_1=__webpack_require__("./Script/core/Sigleton.ts");const UIManager_1=__webpack_require__("./Script/core/UIManager.ts");class TSEventCenter extends Sigleton_1.Sigleton{constructor(){super(...arguments);this.map=new Map}static getInstance(){return super.getInstance(TSEventCenter)}initInstance(){let inst=csharp_1.EventCenter.Instance;inst.bind(csharp_1.TSEvent.CLOSE_VIEW,this,this.closeView);inst.bind(csharp_1.TSEvent.PERLOAD_VIEW,this,this.perloadView);inst.bind(csharp_1.TSEvent.OPEN_VIEW,this,this.openView)}bind(name,thisobj,func){let arr=this.map.get(name);if(arr){let len=arr.length;for(let i=0;i<len;i++){if(arr[i][0]==func&&arr[i][1]==thisobj){csharp_1.Log.logWarning("重复注册事件",name);return}}}else{this.map.set(name,[]);arr=this.map.get(name)}arr.push([func,thisobj])}unbind(name,thisobj){let arr=this.map.get(name);if(arr){let len=arr.length;for(let i=len-1;i>=0;i--){if(arr[i][1]==thisobj){arr.splice(i,1)}}}if(arr&&arr.length==0){this.map.delete(name)}}event(name,...data){let arr=this.map.get(name);if(arr){for(let i=arr.length-1;i>=0;i--){let f=arr[i][0];f.apply(arr[i][1],data)}}}closeView(obj,args){let uiid2=args.get_Item(0);UIManager_1.UIManager.getInstance().closeView(uiid2)}perloadView(obj,args){let uiid=args.get_Item(0);let obj2=args.get_Item(1);UIManager_1.UIManager.getInstance().preLoadView(uiid,obj2)}openView(obj,args){let uiid2=args.get_Item(0);let obj2=args.get_Item(1);let iscache=args.get_Item(2);let args1;if(args.Length>3)args1=args.get_Item(3);UIManager_1.UIManager.getInstance().openView(uiid2,obj2,iscache,args1)}}exports.TSEventCenter=TSEventCenter},"./Script/event/ViewEvent.ts":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ViewEvent=void 0;var ViewEvent;(function(ViewEvent){ViewEvent["VIEW_CLOSE"]="VIEW_CLOSE";ViewEvent["VIEW_OPEN"]="VIEW_OPEN";ViewEvent["VIEW_PRELOAD_OVER"]="VIEW_PRELOAD_OVER"})(ViewEvent=exports.ViewEvent||(exports.ViewEvent={}))},"./Script/fight/Com/RoleCom.ts":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.RoleCom=void 0;const ECSComponent_1=__webpack_require__("./Script/core/ecs/base/ECSComponent.ts");class RoleCom extends ECSComponent_1.ECSComponent{constructor(){super(...arguments);this.entityId=0;this.roleId=0;this.modelId=0}get name(){return RoleCom.ComName}recycleToObjectPool(){super.recycleToObjectPool()}}exports.RoleCom=RoleCom;RoleCom.ComName="RoleCom"},"./Script/fight/Com/VoCom.ts":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.VoCom=void 0;const ECSComponent_1=__webpack_require__("./Script/core/ecs/base/ECSComponent.ts");class VoCom extends ECSComponent_1.ECSComponent{constructor(){super(...arguments);this.entityId=0;this.isMove=false}get name(){return VoCom.ComName}recycleToObjectPool(){super.recycleToObjectPool();this.gameObject=null;this.ani=null}}exports.VoCom=VoCom;VoCom.ComName="VoCom"},"./Script/fight/World.ts":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.World=void 0;const ECSManager_1=__webpack_require__("./Script/core/ecs/base/ECSManager.ts");const RoleCom_1=__webpack_require__("./Script/fight/Com/RoleCom.ts");const Sigleton_1=__webpack_require__("./Script/core/Sigleton.ts");const VoCom_1=__webpack_require__("./Script/fight/Com/VoCom.ts");class World extends Sigleton_1.Sigleton{constructor(){super(...arguments);this.roleEId=0;this.nowInCube=0}static getInstance(){return super.getInstance(World)}async init(){let entity=ECSManager_1.ECSManager.getInstance().createEntity();this.roleEId=entity.id;let com=entity.addCom(RoleCom_1.RoleCom);let vocom=entity.addCom(VoCom_1.VoCom);vocom.ani=this.ani;vocom.gameObject=this.role;let en=ECSManager_1.ECSManager.getInstance().getEntity(this.roleEId);let vo=en.getCom(VoCom_1.VoCom);vo.isMove=false}}exports.World=World},"./Script/utils/LogTS.ts":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.errLog=exports.gzaLog=void 0;const csharp_1=__webpack_require__("csharp");let isDebug=true;if(isDebug)csharp_1.Log.setDeBug();let gzaLog=(...data)=>{if(!isDebug){return}csharp_1.Log.log(...data)};exports.gzaLog=gzaLog;let errLog=(...data)=>{if(!isDebug){return}csharp_1.Log.logError(...data)};exports.errLog=errLog},"./Script/view/MainUIView/MainUIBinder.ts":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const csharp_1=__webpack_require__("csharp");const MainUIView_1=__webpack_require__("./Script/view/MainUIView/MainUIView.ts");class MainUIBinder{static BindAll(){csharp_1.FairyGUI.UIObjectFactory.SetPackageItemExtension(MainUIView_1.MainUIView.URL,()=>{return new MainUIView_1.MainUIView})}}exports.default=MainUIBinder},"./Script/view/MainUIView/MainUIView.ts":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MainUIView=void 0;const csharp_1=__webpack_require__("csharp");const BaseView_1=__webpack_require__("./Script/core/BaseView.ts");const csharp_2=__webpack_require__("csharp");class MainUIView extends BaseView_1.BaseView{constructor(){super()}static createInstance(){return csharp_1.FairyGUI.UIPackage.CreateObject("MainUI","MainUIView")}onInit(){this.levelUpClick=this.GetChild("levelUpClick");this.loader_1=this.GetChild("loader_1");this.loader_2=this.GetChild("loader_2");this.progressBar=this.GetChild("progressBar");this.btn_upLevel=this.GetChild("btn_upLevel");this.txt_1=this.GetChild("txt_1");this.txt_2=this.GetChild("txt_2");this.txt_level=this.GetChild("txt_level");this.txt_percent=this.GetChild("txt_percent");this.btn_clear=this.GetChild("btn_clear");this.img_levelUp=this.GetChild("img_levelUp")}onOpen(args1){super.onOpen(args1);let ins=csharp_2.EventCenter.Instance}onClose(){super.onClose();this.levelUpClick.onClick.Clear();this.btn_clear.onClick.Clear();this.img_levelUp.onClick.Clear()}onDestroy(){super.onDestroy()}}exports.MainUIView=MainUIView;MainUIView.URL="ui://mbhw74n8hzlo0"},"./Script/view/TSMain.ts":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.__cacheDic=void 0;const csharp_1=__webpack_require__("csharp");const ViewConst_1=__webpack_require__("./Script/core/ViewConst.ts");const UIManager_1=__webpack_require__("./Script/core/UIManager.ts");const TSEventCenter_1=__webpack_require__("./Script/event/TSEventCenter.ts");const TimerTS_1=__webpack_require__("./Script/core/TimerTS.ts");const ViewEvent_1=__webpack_require__("./Script/event/ViewEvent.ts");const ECSManager_1=__webpack_require__("./Script/core/ecs/base/ECSManager.ts");const World_1=__webpack_require__("./Script/fight/World.ts");exports.__cacheDic=new Map;function initTS(){ViewConst_1.ViewConst.init();let event=TSEventCenter_1.TSEventCenter.getInstance();let tsUIMgr=UIManager_1.UIManager.getInstance();let timer=TimerTS_1.TimerTS.getInstance();let ecs=ECSManager_1.ECSManager.getInstance();let loa=new loading;loa.loadingConfig()}class loading{async loadingConfig(){let view=csharp_1.GameStart.UI_GameStartView.gameStartView;view.m_txt.text="加载游戏配置中...";this.loadingConfigOver()}async loadingConfigOver(){let view=csharp_1.GameStart.UI_GameStartView.gameStartView;view.m_pb.value+=16;view.m_txt.text="加载主界面中...";await UIManager_1.UIManager.getInstance().addPackage("FloatFont");await UIManager_1.UIManager.getInstance().addPackage("Public");let tsUIMgr=UIManager_1.UIManager.getInstance();tsUIMgr.preLoadView(ViewConst_1.ViewConst.MainUIView_ID,UIManager_1.UILayer.Main);let event=TSEventCenter_1.TSEventCenter.getInstance();event.bind(ViewEvent_1.ViewEvent.VIEW_PRELOAD_OVER,this,this.loadingScene)}async loadingScene(){let view=csharp_1.GameStart.UI_GameStartView.gameStartView;view.m_txt.text="加载游戏场景中...";view.m_pb.value+=16;let model=new csharp_1.UnityEngine.SceneManagement.LoadSceneParameters(csharp_1.UnityEngine.SceneManagement.LoadSceneMode.Additive);csharp_1.UnityEngine.SceneManagement.SceneManager.LoadScene(1,model);view.m_pb.value+=16;TimerTS_1.TimerTS.getInstance().once(this,this.loadingSceneOver,.1)}async loadingSceneOver(){let view=csharp_1.GameStart.UI_GameStartView.gameStartView;view.m_pb.value+=16;view.m_txt.text="加载世界中...";World_1.World.getInstance().init();this.loadingViewOver()}loadingViewOver(){TSEventCenter_1.TSEventCenter.getInstance().unbind(ViewEvent_1.ViewEvent.VIEW_PRELOAD_OVER,this);let view=csharp_1.GameStart.UI_GameStartView.gameStartView;view.m_pb.value+=16;this.loadingOver()}loadingOver(){let view=csharp_1.GameStart.UI_GameStartView.gameStartView;view.m_btn.visible=true;view.m_pb.visible=false;view.m_btn.onClick.Add(()=>{this.enterMain()});view.m_txt.text="点击进入游戏"}enterMain(){let view=csharp_1.GameStart.UI_GameStartView.gameStartView;UIManager_1.UIManager.getInstance().openView(ViewConst_1.ViewConst.MainUIView_ID,UIManager_1.UILayer.Main);view.parent.RemoveChild(view);csharp_1.GameStart.UI_GameStartView.gameStartView=null}}initTS()},csharp:function(module,exports){module.exports=require("csharp")},puerts:function(module,exports){module.exports=require("puerts")}});